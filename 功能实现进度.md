# NexusMemo 功能实现进度清单

> 基于《速记软件技术方案.md》的当前实现状态
> 更新时间：2026-02-14

---

## 一、整体架构

### 1.1 前端架构
- [ ] React 前端 (Vite + Ant Design)
  - [x] Vite + React + TypeScript 基础框架已搭建
  - [x] Ant Design 已安装
  - [ ] 注册/偏好页面
  - [ ] 分类管理页面
  - [ ] 速记编辑页面
  - [ ] 录音功能页面
  - [ ] 搜索页面
  - [ ] 展示页面（事件视图、时间线视图）
  - [ ] 图谱可视化组件

### 1.2 后端架构
- [x] FastAPI 业务网关层
  - [x] 主应用入口 (main.py)
  - [x] CORS 配置
  - [x] 健康检查接口
  - [x] 用户服务 (auth.py)
  - [x] 速记服务 (memos.py)
  - [x] 分类服务 (category.py)
  - [ ] 搜索服务

### 1.3 AI Agent 层
- [x] LangChain / LangGraph Agent 层
  - [x] 分类生成Agent (classify.py)
  - [x] 标签提取Agent (extract.py)
  - [x] 关系发现Agent (find_relations.py)
  - [x] 事件关联Agent (bind_events.py)
  - [ ] 语义搜索Agent

### 1.4 异步任务层
- [ ] Celery + Redis (异步任务 & 定时任务)
  - [ ] Celery Worker 配置
  - [ ] Celery Beat 配置
  - [ ] 异步任务队列
  - [ ] 定时任务调度

### 1.5 语音识别服务
- [ ] Whisper 语音识别服务
  - [ ] faster-whisper 集成
  - [ ] 音频转文字接口

---

## 二、数据模型设计

### 2.1 MySQL 数据模型
- [x] 用户表 (users)
  - [x] 表结构定义
  - [x] 用户注册逻辑
  - [x] 用户登录逻辑
  - [x] 密码哈希（bcrypt，截取到70字节）
- [x] 会话表 (sessions)
  - [x] 表结构定义
  - [x] 会话管理逻辑（创建、验证、删除）
- [x] 速记元数据表 (memos)
  - [x] 表结构定义
  - [x] 创建速记接口
  - [x] 获取速记列表接口
  - [x] 获取单条速记接口
  - [x] 更新速记接口
  - [x] 删除速记接口
- [x] 用户偏好分类记录 (user_category_preferences)
  - [x] 表结构定义
  - [x] 偏好管理逻辑

### 2.2 Neo4j 图数据模型
- [x] 节点类型
  - [x] User 节点
  - [x] Memo 节点
  - [x] Event 节点
  - [x] Category 节点
  - [x] Tag 节点
  - [x] Entity 节点
  - [x] TimePeriod 节点
- [x] 关系类型
  - [x] OWNS 关系
  - [x] PREFERS 关系
  - [x] BELONGS_TO 关系
  - [x] HAS_TAG 关系
  - [x] MENTIONS 关系
  - [x] HAPPENED_ON 关系
  - [x] RELATED_TO 关系
  - [x] LINKED_TO 关系
  - [x] CHILD_OF 关系
  - [x] CO_OCCURS 关系
- [x] 索引创建
  - [x] 节点索引
  - [x] 全文索引
  - [ ] 向量索引

### 2.3 Redis 用途
- [ ] 会话缓存
- [ ] 热数据缓存
- [ ] Celery Broker
- [ ] 限流

---

## 三、各模块详细设计

### 3.1 注册模块
- [x] 用户注册流程
  - [ ] 注册页面
  - [x] 选择一级偏好分类（10个预定义分类）
  - [x] LangChain 生成二级分类（PydanticOutputParser）
  - [ ] 用户选择二级分类
  - [x] 写入 MySQL + Neo4j
- [x] 用户登录流程
  - [ ] 登录页面
  - [x] 密码验证（bcrypt）
  - [x] 生成会话 Token
  - [x] 写入 Redis 缓存

### 3.2 分类模块
- [x] 四维度检索模型设计
- [x] LangGraph 工作流
  - [x] load_context 节点
  - [x] classify 节点
  - [x] extract 节点
  - [x] find_relations 节点
  - [x] judge_relations 节点
  - [x] bind_events 节点
  - [x] persist_graph 节点
- [ ] 分类管理界面
- [ ] 标签管理界面
- [ ] 关系管理界面
- [ ] 事件管理界面

### 3.3 速记模块
- [x] 速记（quick_note）处理流程
  - [x] 用户输入内容 → 存入 MySQL
  - [x] LangGraph Agent 执行
  - [x] 查询用户现有的分类树和标签
  - [x] 根据现有分类匹配最合适的分类
  - [x] 从内容中提取标签
  - [x] 从内容中提取实体
  - [x] 用提取的实体和标签去 Neo4j 查询相关内容
  - [x] 根据相关内容判断关联强度
  - [x] 如果内容涉及已有事件，建立 LINKED_TO 关系
  - [x] 将所有图谱数据写入 Neo4j
- [x] 事件（event）处理流程
  - [x] 用户创建事件 → 存入 MySQL
  - [x] LangGraph Agent 执行
  - [x] 对事件内容进行深度分析
  - [x] 全量扫描用户的所有速记和事件
  - [x] Agent 自主决策哪些内容与该事件相关
  - [x] 建立关联关系并标注关联原因
  - [x] 写入 Neo4j

### 3.4 录音模块
- [ ] 前端录音 (MediaRecorder API)
- [ ] WebSocket 流式传输 / 录完后上传
- [ ] FastAPI 接收音频
- [ ] 调用 faster-whisper 语音转文字
- [ ] 文字进入速记处理流程
- [ ] 存储（MySQL 存原文 + 音频URL，Neo4j 存图谱）

### 3.5 搜索模块
- [ ] 混合检索策略
  - [ ] Neo4j 向量搜索（语义相似度）
  - [ ] Neo4j 全文搜索（关键词匹配）
  - [ ] GraphCypherQAChain（自然语言转图查询）
  - [ ] 多跳图遍历（关系链探索）
  - [ ] 结果融合 + LLM 排序 + 返回
- [ ] 搜索界面

### 3.6 展示模块
- [ ] 事件视图
  - [ ] 事件看板/列表
  - [ ] 事件展开查看关联速记
  - [ ] 事件间关联连线
  - [ ] react-force-graph 关系图可视化
- [ ] 时间线视图
  - [ ] 按时间轴排列所有速记和事件
  - [ ] 按日/周/月粒度切换
  - [ ] 同一时间段内容聚合
  - [ ] 时间线标注重要事件节点

---

## 四、定时任务设计

| 任务 | 频率 | 状态 | 说明 |
|------|------|------|------|
| 标签共现计算 | 每天凌晨 | [ ] | 统计标签共现关系，更新 Tag 节点间的 CO_OCCURS 权重 |
| 事件关联刷新 | 每 6 小时 | [ ] | 对最近新增的速记，重新检查是否有遗漏的事件关联 |
| embedding 更新 | 实时 + 每天全量 | [ ] | 新内容实时生成 embedding，每天全量检查缺失 |
| 社区检测 | 每周 | [ ] | 使用 Neo4j GDS 的 Leiden 算法对内容做社区聚类 |
| 缓存预热 | 每天上午 | [ ] | 预加载热门页面的缓存数据 |

---

## 五、部署方案

- [ ] Docker + docker-compose
  - [ ] MySQL 容器
  - [ ] Neo4j 容器
  - [ ] Redis 容器
  - [ ] Backend 容器
  - [ ] Frontend 容器
  - [ ] Celery Worker 容器
  - [ ] Celery Beat 容器
- [ ] 环境配置
  - [ ] 生产环境配置
  - [ ] 数据库迁移脚本
  - [ ] Neo4j 初始化脚本

---

## 六、开发路线图进度

### Phase 1: 基础框架（2 周）
- [x] 搭建前后端框架
- [x] 完成用户注册/登录
- [x] 基础速记 CRUD（仅 MySQL，暂不接入 Neo4j）

**进度：100%**

### Phase 2: 知识图谱基础（2 周）
- [x] 集成 Neo4j
- [x] 实现分类模块（一级+二级）
- [x] LangChain 分类生成
- [x] 基础图谱查询

**进度：100%**

### Phase 3: AI 智能化（3 周）
- [x] 实现 LangGraph Agent 工作流
- [x] 标签提取、实体抽取、关系发现
- [x] 速记关联逻辑
- [x] 事件关联逻辑

**进度：100%**

### Phase 4: 搜索与展示（2 周）
- [ ] 混合检索搜索
- [ ] 事件视图
- [ ] 时间线视图
- [ ] 图谱可视化

**进度：0%**

### Phase 5: 录音与高级功能（1 周）
- [ ] Whisper 集成
- [ ] 前端录音控件
- [ ] 社区检测与自动聚类

**进度：0%**

### Phase 6: 优化与部署（1 周）
- [ ] 性能优化
- [ ] Docker 部署
- [ ] 监控与日志

**进度：0%**

---

## 七、总体进度统计

| 模块 | 完成度 | 说明 |
|------|--------|------|
| 前端 | 10% | 仅基础框架，无实际功能 |
| 后端框架 | 95% | FastAPI 框架完成，用户服务、分类服务已完成 |
| AI Agent | 90% | LangGraph 工作流完成，缺少搜索 Agent |
| 数据层 | 75% | MySQL + Neo4j 完成，用户认证完成，缺少 Redis |
| 搜索模块 | 0% | 未开始 |
| 展示模块 | 0% | 未开始 |
| 录音模块 | 0% | 未开始 |
| 异步任务 | 0% | 未开始 |
| 部署 | 0% | 未开始 |

**总体进度：约 35%**

---

## 八、下一步计划

### 优先级 P0（核心功能）
1. 完成用户注册/登录功能
2. 实现前端基础页面（注册、速记编辑、列表展示）
3. 实现搜索模块（混合检索）
4. 实现展示模块（事件视图、时间线视图）

### 优先级 P1（重要功能）
1. 实现录音模块
2. 实现 Celery 异步任务
3. 实现 Redis 缓存
4. 实现图谱可视化

### 优先级 P2（优化功能）
1. 性能优化
2. Docker 部署
3. 监控与日志
4. 社区检测与自动聚类

---

## 九、技术债务

1. **前端缺失**：前端仅有基础框架，需要大量开发工作
2. **用户系统缺失**：用户注册/登录、会话管理未实现
3. **同步处理**：当前使用同步处理，应改为 Celery 异步处理
4. **Redis 未使用**：Redis 已配置但未实际使用
5. **向量索引缺失**：Neo4j 向量索引未创建，影响语义搜索
6. **测试覆盖不足**：仅有少量单元测试，需要更多集成测试
7. **错误处理不完善**：需要更完善的错误处理和日志记录
8. **文档缺失**：API 文档、部署文档等需要补充

---

## 十、备注

- 当前实现主要集中在后端核心逻辑和 AI Agent 工作流
- 前端、搜索、展示等用户可见功能尚未实现
- 异步任务、缓存等性能优化功能尚未实现
- 部署方案尚未实施
- 建议优先完成 P0 级别的核心功能，让系统可演示使用
